@page "/forgot-password"
@using HarborFlowSuite.Client.Services
@using HarborFlowSuite.Client.Layout
@layout AuthLayout
@inject IAuthService AuthService
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar

<MudCard Elevation="4" Class="glass-card rounded-xl pa-4 animate-fade-in-up" Style="width: 100%; max-width: 400px;">
    <MudCardHeader Class="d-flex justify-center">
        <CardHeaderContent>
            <div class="d-flex flex-column align-center">
                <MudIcon Icon="@Icons.Material.Filled.LockReset" Size="Size.Large" Color="Color.Primary" Class="mb-2" />
                <MudText Typo="Typo.h4" Class="font-weight-bold">Reset Password</MudText>
                <MudText Typo="Typo.body2" Class="mud-text-secondary">Enter your email to receive a reset link</MudText>
            </div>
        </CardHeaderContent>
    </MudCardHeader>
    <MudCardContent>
        <EditForm Model="@_email" OnValidSubmit="HandleSubmit">
            <DataAnnotationsValidator />
            <MudTextField @bind-Value="_email" Label="Email" Variant="Variant.Outlined" Adornment="Adornment.Start"
                AdornmentIcon="@Icons.Material.Filled.Email" Class="mb-4" FullWidth="true" Required="true"
                RequiredError="Email is required!" />

            <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" FullWidth="true"
                Size="Size.Large" Class="mt-2 shadow-lg" Disabled="@_isSending">
                @if (_isSending)
                {
                    <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true" />
                    <MudText Class="ms-2">Sending...</MudText>
                }
                else
                {
                    <MudText>Send Reset Link</MudText>
                }
            </MudButton>
        </EditForm>
    </MudCardContent>
    <MudCardActions Class="d-flex justify-center pb-4">
        <MudText Typo="Typo.body2">Remember your password? <MudLink Href="/login" Color="Color.Primary"
                Underline="Underline.Hover">Login here</MudLink>
        </MudText>
    </MudCardActions>
</MudCard>

<style>
    .glass-card {
        background: rgba(255, 255, 255, 0.1) !important;
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }

    .mud-theme-dark .glass-card {
        background: rgba(30, 41, 59, 0.7) !important;
        border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .animate-fade-in-up {
        animation: fadeInUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        opacity: 0;
    }

    @@keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

@code {
    private string _email = "";
    private bool _isSending = false;

    private async Task HandleSubmit()
    {
        if (string.IsNullOrWhiteSpace(_email))
            return;

        _isSending = true;
        try
        {
            await AuthService.SendPasswordResetEmail(_email);
            Snackbar.Add("Password reset email sent! Check your inbox.", Severity.Success);
            await Task.Delay(2000); // Give user time to read message
            NavigationManager.NavigateTo("/login");
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error: {ex.Message}", Severity.Error);
        }
        finally
        {
            _isSending = false;
        }
    }
}
