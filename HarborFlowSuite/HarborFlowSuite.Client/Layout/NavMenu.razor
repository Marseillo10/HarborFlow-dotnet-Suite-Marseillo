@using Microsoft.AspNetCore.Components.Authorization
@using HarborFlowSuite.Client.Services
@inject IAuthService AuthService
@inject NavigationManager NavigationManager

<div class="d-flex flex-column h-100">
    <MudNavMenu>
        <MudText Typo="Typo.subtitle2" Class="px-4 mt-4 mb-2 mud-text-secondary"><b>MENU</b></MudText>
        <MudNavLink Href="" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Home">Home</MudNavLink>
        <AuthorizeView>
            <Authorized>
                <MudNavLink Href="dashboard" Icon="@Icons.Material.Filled.Dashboard">Dashboard</MudNavLink>
                <MudNavLink Href="nautical-chart" Icon="@Icons.Material.Filled.Map">Nautical Chart</MudNavLink>
                <MudNavLink Href="vessel-management" Icon="@Icons.Material.Filled.DirectionsBoat">Vessel Management
                </MudNavLink>
                <MudNavLink Href="service-request-management" Icon="@Icons.Material.Filled.Build">Service Requests
                </MudNavLink>
                <MudNavLink Href="company-management" Icon="@Icons.Material.Filled.Business">Company Management
                </MudNavLink>
            </Authorized>
        </AuthorizeView>
    </MudNavMenu>

    <MudSpacer />

    <AuthorizeView>
        <Authorized>
            <div class="pa-4">
                <MudDivider Class="mb-4" />
                <div class="d-flex align-center gap-3 mb-4">
                    <MudAvatar Color="Color.Secondary" Variant="Variant.Filled">
                        @(context.User.Identity?.Name?.FirstOrDefault().ToString().ToUpper() ?? "U")
                    </MudAvatar>
                    <div class="d-flex flex-column">
                        <MudText Typo="Typo.subtitle2"><b>@(context.User.Identity?.Name ?? "User")</b></MudText>
                        <MudText Typo="Typo.caption" Class="mud-text-secondary">Administrator</MudText>
                    </div>
                </div>
                <MudButton Variant="Variant.Outlined" Color="Color.Error" FullWidth="true"
                    StartIcon="@Icons.Material.Filled.Logout" OnClick="HandleLogout">
                    Log Out
                </MudButton>
            </div>
        </Authorized>
        <NotAuthorized>
            <MudNavMenu>
                <MudDivider Class="my-2" />
                <MudNavLink Href="register" Icon="@Icons.Material.Filled.PersonAdd">Register</MudNavLink>
                <MudNavLink Href="login" Icon="@Icons.Material.Filled.Login">Login</MudNavLink>
            </MudNavMenu>
        </NotAuthorized>
    </AuthorizeView>
</div>

@code {
    private async Task HandleLogout()
    {
        await AuthService.SignOut();
        NavigationManager.NavigateTo("/");
    }
}
